syntax = "proto3";
package commonfate.control.integration.v1alpha1;

import "commonfate/control/integration/v1alpha1/gcp.proto";
import "commonfate/control/integration/v1alpha1/aws_idc.proto";
import "commonfate/control/integration/v1alpha1/slack.proto";
import "commonfate/control/integration/v1alpha1/pagerduty.proto";
import "commonfate/access/v1alpha1/diagnostic.proto";

service IntegrationService {
    rpc CreateIntegration(CreateIntegrationRequest) returns (CreateIntegrationResponse) {}
    rpc UpdateIntegration(UpdateIntegrationRequest) returns (UpdateIntegrationResponse) {}
    rpc GetIntegration(GetIntegrationRequest) returns (GetIntegrationResponse) {}
    rpc DeleteIntegration(DeleteIntegrationRequest) returns (DeleteIntegrationResponse) {}
    rpc ListIntegrations(ListIntegrationsRequest) returns (ListIntegrationsResponse) {}
}

message ListIntegrationsRequest {
    // The token for the next page.
    string page_token = 1;
}

message ListIntegrationsResponse {
    repeated Integration integrations = 1;
    string next_page_token = 2;
}

message CreateIntegrationRequest {
    string name = 1;
    Parameters details = 2;
}

message Parameters {
    oneof parameters {
        GCP gcp = 1;
        AWSIDC aws_idc = 2;
        Slack slack = 3;
        PagerDuty pagerduty = 4;
    }
}

message Integration {
    reserved 'type';
    reserved 3;

    string id = 1;
    string name = 2;
    Status status = 4;
    repeated commonfate.access.v1alpha1.Diagnostic diagnostics = 5;
    Parameters details = 6;
}

message CreateIntegrationResponse {
    Integration integration = 1;
}

enum Status {
    STATUS_UNSPECIFIED = 0;
    STATUS_PENDING_OAUTH_INSTALL = 1;
    STATUS_HEALTHY = 2;
    STATUS_UNHEALTHY = 3;
}

message GetIntegrationRequest {
    string id = 1;
}

message GetIntegrationResponse {
    Integration integration = 1;
}

message UpdateIntegrationRequest {
    Integration integration = 1;
}

message UpdateIntegrationResponse {
    Integration integration = 1;
}


message DeleteIntegrationRequest {
    string id = 1;
}

message DeleteIntegrationResponse {
    string id = 1;
}